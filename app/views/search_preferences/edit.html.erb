<div data-controller="simple-test" class="bg-white rounded-lg shadow p-6">

  <h2 class="text-2xl font-bold mb-6">Search Preferences</h2>

  <!-- ░░░░░░░░░░ Job Titles ░░░░░░░░░░ -->
  <div class="mb-8" data-controller="job-title-preference">
    <h3 class="text-xl font-bold mb-4">Job Titles</h3>

    <div class="mb-4">
      <p class="text-gray-600 mb-4">Enter job titles you're interested in. Higher priority titles will be given preference in filtering.</p>

      <div data-job-title-preference-target="errors"></div>

      <!-- New job title form -->
      <div class="bg-gray-50 p-4 rounded mb-4" data-job-title-preference-target="form">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_job_title">Job Title</label>
            <input type="text" id="new_job_title" data-job-title-preference-target="title" class="w-full p-2 border rounded" placeholder="e.g. Software Engineer">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_job_title_priority">Priority</label>
            <input type="number" id="new_job_title_priority" data-job-title-preference-target="priority" min="1" value="1" class="w-full p-2 border rounded">
          </div>
        </div>
        <div class="mt-4 text-right">
          <button type="button" data-action="job-title-preference#add" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            Add Job Title
          </button>
        </div>
      </div>

      <!-- Job titles list -->
      <div id="job_titles" class="space-y-4 transition-all duration-300" data-job-title-preference-target="list">
        <% @search_preference.job_title_preferences.each do |pref| %>
          <div class="nested-fields bg-gray-50 p-4 rounded transition-opacity duration-300" data-preference-id="<%= pref.id %>">
            <!-- View Mode -->
            <div class="view-mode">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="col-span-2">
                  <span class="font-semibold">Title:</span> <span data-display="title"><%= pref.title %></span>
                </div>
                <div>
                  <span class="font-semibold">Priority:</span> <span data-display="priority"><%= pref.priority %></span>
                </div>
              </div>
              <div class="mt-2 text-right">
                <a href="#" data-action="job-title-preference#toggleEditMode" class="text-blue-600 hover:underline mr-3">Edit</a>
                <a href="#" data-action="job-title-preference#remove" class="text-red-600 hover:underline">Remove</a>
              </div>
            </div>

            <!-- Edit Mode -->
            <div class="edit-mode hidden">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="col-span-2">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Job Title</label>
                  <input type="text" data-field="title" value="<%= pref.title %>" class="w-full p-2 border rounded">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                  <input type="number" data-field="priority" min="1" value="<%= pref.priority %>" class="w-full p-2 border rounded">
                </div>
              </div>
              <div class="mt-2 text-right">
                <button type="button" data-action="job-title-preference#cancelEdit" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 mr-2">Cancel</button>
                <button type="button" data-action="job-title-preference#edit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Template for new job title items -->
      <template data-job-title-preference-target="template">
        <div class="nested-fields bg-gray-50 p-4 rounded transition-opacity duration-300" data-preference-id="NEW_ID">
          <!-- View Mode -->
          <div class="view-mode">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="col-span-2">
                <span class="font-semibold">Title:</span> <span data-display="title">NEW_TITLE</span>
              </div>
              <div>
                <span class="font-semibold">Priority:</span> <span data-display="priority">NEW_PRIORITY</span>
              </div>
            </div>
            <div class="mt-2 text-right">
              <a href="#" data-action="job-title-preference#toggleEditMode" class="text-blue-600 hover:underline mr-3">Edit</a>
              <a href="#" data-action="job-title-preference#remove" class="text-red-600 hover:underline">Remove</a>
            </div>
          </div>

          <!-- Edit Mode -->
          <div class="edit-mode hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Job Title</label>
                <input type="text" data-field="title" value="NEW_TITLE" class="w-full p-2 border rounded">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                <input type="number" data-field="priority" min="1" value="NEW_PRIORITY" class="w-full p-2 border rounded">
              </div>
            </div>
            <div class="mt-2 text-right">
              <button type="button" data-action="job-title-preference#cancelEdit" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 mr-2">Cancel</button>
              <button type="button" data-action="job-title-preference#edit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>

  <!-- ░░░░░░░░░░ Locations ░░░░░░░░░░ -->
  <div class="mb-8" data-controller="location-preference">
    <h3 class="text-xl font-bold mb-4">Locations</h3>

    <div class="mb-4">
      <p class="text-gray-600 mb-4">Enter locations you're interested in. Higher priority locations will be given preference in filtering.</p>

      <div data-location-preference-target="errors"></div>

      <!-- New location form -->
      <div class="bg-gray-50 p-4 rounded mb-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_location_city">City</label>
            <input type="text" id="new_location_city" data-location-preference-target="city" class="w-full p-2 border rounded" placeholder="e.g. San Francisco">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_location_state">State/Province</label>
            <input type="text" id="new_location_state" data-location-preference-target="state" class="w-full p-2 border rounded" placeholder="e.g. CA">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_location_country">Country</label>
            <input type="text" id="new_location_country" data-location-preference-target="country" class="w-full p-2 border rounded" placeholder="e.g. USA">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_location_priority">Priority</label>
            <input type="number" id="new_location_priority" data-location-preference-target="priority" min="1" value="1" class="w-full p-2 border rounded">
          </div>
        </div>
        <div class="mt-4 text-right">
          <button type="button" data-action="location-preference#add" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            Add Location
          </button>
        </div>
      </div>

      <!-- Locations list -->
      <div id="locations" class="space-y-4 transition-all duration-300" data-location-preference-target="list">
        <% @search_preference.location_preferences.each do |pref| %>
          <div class="nested-fields bg-gray-50 p-4 rounded transition-opacity duration-300" data-preference-id="<%= pref.id %>">
            <!-- View Mode -->
            <div class="view-mode">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <span class="font-semibold">City:</span> <span data-display="city"><%= pref.city %></span>
                </div>
                <div>
                  <span class="font-semibold">State:</span> <span data-display="state"><%= pref.state %></span>
                </div>
                <div>
                  <span class="font-semibold">Country:</span> <span data-display="country"><%= pref.country %></span>
                </div>
                <div>
                  <span class="font-semibold">Priority:</span> <span data-display="priority"><%= pref.priority %></span>
                </div>
              </div>
              <div class="mt-2 text-right">
                <a href="#" data-action="location-preference#toggleEditMode" class="text-blue-600 hover:underline mr-3">Edit</a>
                <a href="#" data-action="location-preference#remove" class="text-red-600 hover:underline">Remove</a>
              </div>
            </div>

            <!-- Edit Mode -->
            <div class="edit-mode hidden">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                  <input type="text" data-field="city" value="<%= pref.city %>" class="w-full p-2 border rounded">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">State/Province</label>
                  <input type="text" data-field="state" value="<%= pref.state %>" class="w-full p-2 border rounded">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                  <input type="text" data-field="country" value="<%= pref.country %>" class="w-full p-2 border rounded">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                  <input type="number" data-field="priority" min="1" value="<%= pref.priority %>" class="w-full p-2 border rounded">
                </div>
              </div>
              <div class="mt-2 text-right">
                <button type="button" data-action="location-preference#cancelEdit" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 mr-2">Cancel</button>
                <button type="button" data-action="location-preference#edit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Template for new location items -->
      <template data-location-preference-target="template">
        <div class="nested-fields bg-gray-50 p-4 rounded transition-opacity duration-300" data-preference-id="NEW_ID">
          <!-- View Mode -->
          <div class="view-mode">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div>
                <span class="font-semibold">City:</span> <span data-display="city">NEW_CITY</span>
              </div>
              <div>
                <span class="font-semibold">State:</span> <span data-display="state">NEW_STATE</span>
              </div>
              <div>
                <span class="font-semibold">Country:</span> <span data-display="country">NEW_COUNTRY</span>
              </div>
              <div>
                <span class="font-semibold">Priority:</span> <span data-display="priority">NEW_PRIORITY</span>
              </div>
            </div>
            <div class="mt-2 text-right">
              <a href="#" data-action="location-preference#toggleEditMode" class="text-blue-600 hover:underline mr-3">Edit</a>
              <a href="#" data-action="location-preference#remove" class="text-red-600 hover:underline">Remove</a>
            </div>
          </div>

          <!-- Edit Mode -->
          <div class="edit-mode hidden">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                <input type="text" data-field="city" value="NEW_CITY" class="w-full p-2 border rounded">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">State/Province</label>
                <input type="text" data-field="state" value="NEW_STATE" class="w-full p-2 border rounded">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                <input type="text" data-field="country" value="NEW_COUNTRY" class="w-full p-2 border rounded">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                <input type="number" data-field="priority" min="1" value="NEW_PRIORITY" class="w-full p-2 border rounded">
              </div>
            </div>
            <div class="mt-2 text-right">
              <button type="button" data-action="location-preference#cancelEdit" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 mr-2">Cancel</button>
              <button type="button" data-action="location-preference#edit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>

  <!-- ░░░░░░░░░░ Industries ░░░░░░░░░░ -->
  <div class="mb-8" data-controller="industry-preference">
    <h3 class="text-xl font-bold mb-4">Industries</h3>

    <div class="mb-4">
      <p class="text-gray-600 mb-4">Enter industries you're interested in or want to exclude. Higher priority industries will be given preference in filtering.</p>

      <div data-industry-preference-target="errors"></div>

      <!-- New industry form -->
      <div class="bg-gray-50 p-4 rounded mb-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_industry">Industry</label>
            <input type="text" id="new_industry" data-industry-preference-target="industry" class="w-full p-2 border rounded" placeholder="e.g. Technology">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">&nbsp;</label>
            <div class="flex items-center mt-2">
              <input type="checkbox" id="new_industry_blacklisted" data-industry-preference-target="isBlacklisted" data-action="change->industry-preference#togglePriorityField" class="mr-2">
              <span>Blacklist this industry</span>
            </div>
          </div>
          <div data-industry-preference-target="priorityField">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="new_industry_priority">Priority</label>
            <input type="number" id="new_industry_priority" data-industry-preference-target="priority" min="1" value="1" class="w-full p-2 border rounded">
          </div>
        </div>
        <div class="mt-4 text-right">
          <button type="button" data-action="industry-preference#add" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            Add Industry
          </button>
        </div>
      </div>

      <!-- Industries list -->
      <div id="industries" class="space-y-4 transition-all duration-300" data-industry-preference-target="list">
        <% @search_preference.industry_preferences.each do |pref| %>
          <div class="nested-fields bg-gray-50 p-4 rounded transition-opacity duration-300" data-preference-id="<%= pref.id %>">
            <!-- View Mode -->
            <div class="view-mode">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <span class="font-semibold">Industry:</span> <span data-display="industry"><%= pref.industry %></span>
                </div>
                <div>
                  <span data-display="blacklist-icon" class="<%= pref.is_blacklisted ? '' : 'hidden' %>">
                    <span class="inline-flex items-center px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
                      Blacklisted
                    </span>
                  </span>
                </div>
                <div>
                  <span class="font-semibold">Priority:</span> <span data-display="priority"><%= pref.is_blacklisted ? 'Blacklisted' : pref.priority %></span>
                </div>
              </div>
              <div class="mt-2 text-right">
                <a href="#" data-action="industry-preference#toggleEditMode" class="text-blue-600 hover:underline mr-3">Edit</a>
                <a href="#" data-action="industry-preference#remove" class="text-red-600 hover:underline">Remove</a>
              </div>
            </div>

            <!-- Edit Mode -->
            <div class="edit-mode hidden">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                  <input type="text" data-field="industry" value="<%= pref.industry %>" class="w-full p-2 border rounded">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">&nbsp;</label>
                  <div class="flex items-center mt-2">
                    <input type="checkbox" data-field="is_blacklisted" <%= pref.is_blacklisted ? 'checked' : '' %> data-action="change->industry-preference#toggleItemPriorityField" class="mr-2">
                    <span>Blacklist this industry</span>
                  </div>
                </div>
                <div data-edit-field="priority" class="<%= pref.is_blacklisted ? 'hidden' : '' %>">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                  <input type="number" data-field="priority" min="1" value="<%= pref.priority || 1 %>" class="w-full p-2 border rounded">
                </div>
              </div>
              <div class="mt-2 text-right">
                <button type="button" data-action="industry-preference#cancelEdit" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 mr-2">Cancel</button>
                <button type="button" data-action="industry-preference#edit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Template for new industry items -->
      <template data-industry-preference-target="template">
        <div class="nested-fields bg-gray-50 p-4 rounded transition-opacity duration-300" data-preference-id="NEW_ID">
          <!-- View Mode -->
          <div class="view-mode">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <span class="font-semibold">Industry:</span> <span data-display="industry">NEW_INDUSTRY</span>
              </div>
              <div>
                <span data-display="blacklist-icon" class="NEW_BLACKLISTED_HIDDEN">
                  <span class="inline-flex items-center px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
                    Blacklisted
                  </span>
                </span>
              </div>
              <div>
                <span class="font-semibold">Priority:</span> <span data-display="priority">NEW_PRIORITY_TEXT</span>
              </div>
            </div>
            <div class="mt-2 text-right">
              <a href="#" data-action="industry-preference#toggleEditMode" class="text-blue-600 hover:underline mr-3">Edit</a>
              <a href="#" data-action="industry-preference#remove" class="text-red-600 hover:underline">Remove</a>
            </div>
          </div>

          <!-- Edit Mode -->
          <div class="edit-mode hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                <input type="text" data-field="industry" value="NEW_INDUSTRY" class="w-full p-2 border rounded">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">&nbsp;</label>
                <div class="flex items-center mt-2">
                  <input type="checkbox" data-field="is_blacklisted" data-action="change->industry-preference#toggleItemPriorityField" class="mr-2">
                  <span>Blacklist this industry</span>
                </div>
              </div>
              <div data-edit-field="priority">
                <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                <input type="number" data-field="priority" min="1" value="1" class="w-full p-2 border rounded">
              </div>
            </div>
            <div class="mt-2 text-right">
              <button type="button" data-action="industry-preference#cancelEdit" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 mr-2">Cancel</button>
              <button type="button" data-action="industry-preference#edit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>

  <!-- ░░░░░░░░░░ Automation ░░░░░░░░░░ -->
  <div class="mb-8">
    <h3 class="text-xl font-bold mb-4">Automation Settings</h3>
    <div class="mb-4" data-controller="auto-search">
      <div class="flex items-center">
        <input type="checkbox" id="auto_search_enabled" data-auto-search-target="checkbox" <%= @search_preference.auto_search_enabled ? 'checked' : '' %> class="mr-2" data-action="change->auto-search#toggle">
        <label for="auto_search_enabled" class="text-gray-700">Enable automatic daily searches</label>
      </div>
      <p class="text-gray-500 text-sm mt-1">When enabled, the system will automatically search for new job listings daily.</p>
    </div>
  </div>
</div>
